#!/bin/bash

cd $(dirname $0)/..

exists() {
    [ -e "$1" ]
}
if [[ $(uname -m) != "arm"* ]]; then
    PROFILE=--profile x86
else
    echo "some modules are not ARM compatible yet so skipping them."
    PROFILE=
if exists Artemis-modules-extra; then
    ADDITIONAL_OPTIONS=--scale=karton-sqlmap=5
else
    echo "you do not have Artemis-modules-extra installed. please refer to https://artemis-scanner.readthedocs.io/en/latest/quick-start.html"
    ADDITIONAL_OPTIONS=
fi

# We don't use `-d` here so that the user sees the logs by default.
. scripts/run_docker_compose up --build \
    --scale=karton-wp_scanner=3 \
    --scale=karton-identifier=3 \
    --scale=karton-port_scanner=5 \
    --scale=karton-wordpress_plugins=5 \
    --scale=karton-nuclei=5 \
    --scale=karton-bruter=5 \
    $ADDITIONAL_OPTIONS \
    $PROFILE