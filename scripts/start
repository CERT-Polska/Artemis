#!/bin/bash

cd $(dirname $0)/..

exists() {
    [ -e "$1" ]
}
if [[ $(uname -m) != "arm"* ]]; then
    PROFILE=--profile not-arm
else
    echo "you have an ARM architecture so we have skipped some modules, for all features we recommend using a x86 architecture system."
    PROFILE=
fi

if exists Artemis-modules-extra; then
    ADDITIONAL_OPTIONS=--scale=karton-sqlmap=5
else
    echo "you do not have Artemis-modules-extra installed. it is recommended to have these modules installed as They detect subdomain takeovers, SSL misconfigurations, SQL injections, and WordPress vulnerabilities.CERT PL finds tens of thousands of misconfigured SSL and hundreds of SQL injections using these modules.
    run git clone https://github.com/CERT-Polska/Artemis-modules-extra.git to install them."
    ADDITIONAL_OPTIONS=
fi

# We don't use `-d` here so that the user sees the logs by default.
. scripts/run_docker_compose $PROFILE up --build \
    --scale=karton-wp_scanner=3 \
    --scale=karton-identifier=3 \
    --scale=karton-port_scanner=5 \
    --scale=karton-wordpress_plugins=5 \
    --scale=karton-nuclei=5 \
    --scale=karton-bruter=5 \
    $ADDITIONAL_OPTIONS